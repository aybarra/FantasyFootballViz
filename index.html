<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">

    <title>Fantasy Football Test</title>

    <script src="d3/d3.js"></script>
    <script src="crossfilter/crossfilter.min.js" type="text/javascript"></script>
    <script src="dc/dc.min.js" type="text/javascript"></script>
    <script src="js/jquery-1.11.3.min.js" type="text/javascript"></script>
    <script src="bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="js/datatables.min.js" type="text/javascript"></script>
    <script src="js/filter_grouping.js"></script>

    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="dc/dc.css" rel="stylesheet" type="text/css">
    <link href="css/dashboard.css" rel="stylesheet">
    <link href="css/layout.css" rel="stylesheet">
    <link href="css/datatables.min.css" rel="stylesheet">

</head>

<body>

<!-- Create Navigation Bar -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand">Armchair Fantasy Football</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="index.html">Overview</a></li>
                <li><a href="career_view.html">Career View</a></li>
                <li><a href="single_season_view.html">Single Season View</a></li>
                <li><a href="single_week_view.html">Single Week View</a></li>
            </ul>
            <form class="navbar-form navbar-right">
                <input type="text" class="form-control" placeholder="Search Player Name">
            </form>
        </div>
    </div>
</nav>

<!-- Create filters -->
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-2 col-md-1 sidebar">
            <!-- Outlined filters -->
            <div class="nav nav-sidebar">
                <div class="list-group">
                    <a href="#" class="list-group-item">
                        Filter 1
                    </a>
                    <a href="#" class="list-group-item">
                        Filter 2
                    </a>
                    <a href="#" class="list-group-item">
                        Filter 3
                    </a>
                </div>
            </div>
            <!-- Dropdown Filters -->
            <div class="nav nav-sidebar">
                <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Dropdown Filter
                        <span class="caret"></span></button>
                    <ul class="dropdown-menu">
                        <li><a href="#">Filter Selection 1</a></li>
                        <li><a href="#">Filter Selection 2</a></li>
                        <li><a href="#">Filter Selection 3</a></li>
                    </ul>
                </div>
            </div>
            <!-- Button Group Filters -->
            <div class="nav nav-sidebar">
                <div class="btn-group-vertical btn-group-md">
                    <button type="button" class="btn btn-primary" href="#">Filter 1</button>
                    <button type="button" class="btn btn-primary" href="#">Filter 2</button>
                    <button type="button" class="btn btn-primary" href="#">Filter 3</button>
                </div>
            </div>
            <!-- Boring filters -->
            <ul class="nav nav-sidebar">
                <li><a href="#">Filter 1</a></li>
                <li><a href="#">Filter 2</a></li>
                <li><a href="#">Filter 3</a></li>
            </ul>
        </div>
    </div>

    <!-- Create Chart Display Areas -->
    <div class="col-sm-10 col-sm-offset-2 col-md-10 col-md-offset-1 main">
        <div class="row" id="large-section">
            <div class="col-sm-12" id="large-section">
                <h4>Large Section</h4>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6" id="box-whisker-chart">
                <h4>Box and Whisker Plot</h4>
            </div>
            <div class="col-md-6" id="histogram">
                <h4>Histogram</h4>
            </div>
        </div>


        <!-- Player Filters -->
        <div class="row">
            <div id="filters">
                <!-- Year Chart DIV-->
                <div class="col-md-6" id="filter_years">
                    <h4>Filter Years</h4>
                </div>
                <!-- Date Chart DIV-->
                <div class="col-md-6" id="filter_dates" style=" clear:both;">
                    <h4>Filter Points</h4>
                </div>
                <!-- Checkbox DIV-->
                <div class="col-md-6" id="filter_position" style=" clear:both;">
                    <h4>Filter Positions</h4>
                    <label>
                        <input type=checkbox name="running_back" value="running_back" id="filter_running_back"/>
                        Running Back
                    </label>
                    <label>
                        <input type=checkbox name="quarter_back" value="quarter_back" id="filter_quarter_back"/>
                        Quarter Back
                    </label>
                    <label>
                        <input type=checkbox name="wr_te" value="wr_te" id="filter_wr_te"/>
                        WR/TE
                    </label>

                </div>
                <div id="filter_info_div" style=" clear:both;"></div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="row">
            <div class="col-md-6">
                <h4>Player Data Table</h4>
                <table class="table table-striped table-borderedr" id="data_table">
                    <thead>
                    <tr class="header">
                        <th>Name</th>
                        <th>Year</th>
                        <th>Fantasy Points</th>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
</div>


<script>

    var yearFormat = d3.time.format( '%Y' );

    var box_margin = { top: 10, right: 30, bottom: 33, left: 45 };
    var box_width = 500// - box_margin.left - box_margin.right;
    var box_height = 150// - box_margin.top - box_margin.bottom;
    var box_chart = dc.boxPlot( "#box-whisker-chart" );

    var scatter_margin = { top: 10, right: 30, bottom: 33, left: 45 };
    var scatter_width = 1000;
    var scatter_height = 500;
    var scatter_chart = dc.scatterPlot( "#large-section" );

    var hist_margin = { top: 10, right: 30, bottom: 33, left: 45 };
    var hist_width = 500;
    var hist_height = 150;
    var hist_chart = dc.barChart( "#histogram" );

    //DATATABLE
    // var data_chart = dc.dataTable( "#data_table" );


    d3.csv( "data/data.csv", function ( error, data )
        {

        data.forEach( function ( x )
        {
            x.short_year = x.Year;
            x.year = yearFormat.parse( x.Year );
            x.name = x.Name;
            x.fantPt = +x.Fantasy_Pts;
            x.winPct = +x.Win_Pct;
        } );

        var ndx = crossfilter( data );

        var box_dimension = ndx.dimension( function ( d )
        {
            return new Date( new Date( d.year ).setDate( 1 ) );
        } );
        var box_group = box_dimension.group().reduce(
                function ( p, v )
                {
                    p.push( v.fantPt );
                    return p;
                },
                function ( p, v )
                {
                    p.splice( p.indexOf( v.fantPt ), 1 );
                    return p;
                },
                function ()
                {
                    return [];
                }
        );

        box_chart
                .width( box_width )
                .height( box_height )
                .margins( box_margin )
                .dimension( box_dimension )
                .group( box_group )
                .boxWidth( 3 )
                .colors( "red" )
                .x( d3.time.scale().domain( [ new Date( "1918" ), new Date( "2016" ) ] ) )
                .round( d3.time.year.round )
                .xUnits( d3.time.year )
                .yAxisLabel( "Fantasy Points" )
                .xAxisLabel( "Year" )
            // .elasticY( true )
            // .elasticX( true )
                .keyAccessor( function ( d )
                {
                    return d.key;
                } )
                .valueAccessor( function ( d )
                {
                    return d.value;
                } )
                .on( "renderlet", function ( box_chart )
                {

                    var gBoxLabels = box_chart.selectAll( "text.box" );
                    var gWhiskLabels = box_chart.selectAll( "text.whisker" );
                    gBoxLabels.remove();
                    gWhiskLabels.remove();

                } );

        var scatterDimension = ndx.dimension( function ( d )
        {
            return [ d.winPct, d.fantPt ];
        } );
        var scatterGroup = scatterDimension.group();

        scatter_chart
                .width( scatter_width )
                .height( scatter_height )
                .margins( scatter_margin )
                .symbolSize( 5 )
                .clipPadding( 10 )
                .x( d3.scale.linear().domain( [ 0, 100 ] ) )
                .dimension( scatterDimension )
                .group( scatterGroup )
            //.brushOn( false )
                .renderTitle( true )
                .title( function ( p )
                {
                    return
                    d.name;
                } )
                .yAxisLabel( "Fantasy Points" )
                .xAxisLabel( "Win Percentage" );

        var histDimension = ndx.dimension( function ( d )
        {
            return d.fantPt;
        } );
        var histGroup = histDimension.group().reduceCount();

        hist_chart
                .width( hist_width )
                .height( hist_height )
                .margins( hist_margin )
                .x( d3.scale.linear().domain( [ 0, 2550 ] ) )
                .dimension( histDimension )
                .group( histGroup )
                .yAxisLabel( "Number of Players" )
                .xAxisLabel( "Fantasy Points" );

        var table_dimension = ndx.dimension( function ( d )
        {
            return d.name;
        } );

        var data_table = $("#data_table").dataTable({
          "bPaginate": true,
          "pagingType": "full_numbers",
          "bLengthChange": false,
          "bFilter": false,
          "bSort": true,
          "bInfo": false,
          "bAutoWidth": false,
          "bDeferRender": true,
          "aaData": table_dimension.top(Infinity),
          "bDestroy": true,
          "aoColumns": [
              { "mData": "name", "sDefaultContent": ""},
              { "mData": "short_year", "sDefaultContent": " " },
              { "mData": "fantPt", "sDefaultContent": " " }
          ]
        });

        function RefreshTable() {
            dc.events.trigger(function () {
                alldata = table_dimension.top(Infinity);
                data_table.fnClearTable();
                data_table.fnAddData(alldata);
                data_table.fnDraw();
          });
        }

        for (var i = 0; i < dc.chartRegistry.list().length; i++) {
            var chartI = dc.chartRegistry.list()[i];
            chartI.on("filtered", RefreshTable);
        }

        dc.renderAll();
    } )

    drawSelectionFilter();

</script>

</body>
</html>
